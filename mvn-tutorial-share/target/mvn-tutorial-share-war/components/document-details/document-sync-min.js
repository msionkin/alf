(function(){var d=YAHOO.util.Dom;Event=YAHOO.util.Event;substitute=YAHOO.lang.substitute;Alfresco.DocumentSync=function f(h){Alfresco.DocumentSync.superclass.constructor.call(this,"Alfresco.DocumentSync",h);YAHOO.Bubbling.on("metadataRefresh",this.doRefresh,this);return this};YAHOO.extend(Alfresco.DocumentSync,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocumentSync,Alfresco.doclib.Actions);YAHOO.lang.augmentObject(Alfresco.DocumentSync.prototype,{options:{nodeRef:null,site:null,documentDetails:null},_getSyncActionButtons:function g(){var h="";var i=this.options.documentDetails.item.actions;if(Alfresco.util.findInArray(i,"document-cloud-sync","id")){h+='<a href="#" class="document-sync-link" title="'+this.msg("label.document.cloud-sync")+'">&nbsp;</a>'}if(Alfresco.util.findInArray(i,"document-cloud-unsync","id")){h+='<a href="#" class="document-unsync-link" title="'+this.msg("label.document.cloud-unsync")+'">&nbsp;</a>'}if(Alfresco.util.findInArray(i,"document-request-sync","id")){h+='<a href="#" class="document-requestsync-link" title="'+this.msg("label.document.cloud-request-sync")+'">&nbsp;</a>'}return h},onReady:function b(){if(Alfresco.util.arrayContains(this.options.documentDetails.item.node.aspects,"sync:syncSetMemberNode")){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+this.options.nodeRef.replace("://","/"),successCallback:{fn:this.onSyncInfoLoaded,scope:this},failureMessage:this.msg("message.failure")})}else{d.get(this.id+"-formContainer").innerHTML=this.msg("content.not.synced")}d.get(this.id+"-heading").innerHTML=substitute(d.get(this.id+"-heading").innerHTML,{syncActionButtons:this._getSyncActionButtons()});var h=d.get(this.id+"-document-sync-twister-actions");d.removeClass(h,"hidden");var j=this.id+"-heading";var i=this._buildRecord();Event.on(d.getElementsByClassName("document-sync-link","a",j),"click",function l(n){Event.preventDefault(n);this.onActionCloudSync(i)},{},this);Event.on(d.getElementsByClassName("document-unsync-link","a",j),"click",function k(n){Event.preventDefault(n);this.onActionCloudUnsync(i)},{},this);Event.on(d.getElementsByClassName("document-requestsync-link","a",j),"click",function m(n){Event.preventDefault(n);this.onActionCloudSyncRequest(i)},{},this)},_buildRecord:function c(){var h=this.options.documentDetails.item;h.jsNode=new Alfresco.util.Node(h.node);return h},onSyncInfoLoaded:function a(i){var j=this;var h={showTitle:false,showRequestSyncButton:false,showUnsyncButton:false,showMoreInfoLink:false};Alfresco.util.getSyncStatus(this,this._buildRecord(),i.json,h,function(l){if(l!=null){var m=j.id+"-formContainer";var k=d.get(m);k.innerHTML=l.html;Alfresco.util.syncClickOnShowDetailsLinkEvent(j,m);Alfresco.util.syncClickOnHideLinkEvent(j,m);Alfresco.util.syncClickOnTransientErrorShowDetailsLinkEvent(j,m);Alfresco.util.syncClickOnTransientErrorHideLinkEvent(j,m)}else{Alfresco.util.PopupManager.displayMessage({text:j.msg("message.failure")})}})},doRefresh:function e(j,i,k){var h=d.get(this.id+"-document-sync-twister-actions");d.addClass(h,"hidden");YAHOO.Bubbling.unsubscribe("metadataRefresh",this.doRefresh,this);if(k.options.documentDetails.item.jsNode.isContainer){this.refresh("components/folder-details/folder-sync?nodeRef={nodeRef}"+(this.options.site?"&site={site}":""))}else{this.refresh("components/document-details/document-sync?nodeRef={nodeRef}"+(this.options.site?"&site={site}":""))}}},true)})();