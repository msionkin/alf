(function(){var E=YAHOO.util.Dom,C=YAHOO.util.Event,r=YAHOO.util.Anim;var z=Alfresco.util.encodeHTML;var s="ygddfdiv",B="377px",n=[-42,25],L=120,b=4,k=52,q=112,G=50,N=315,g=50,A=200;MIMETYPE_PREFIX_IMAGE="image/";Alfresco.DocumentListFilmstripViewRenderer=function(O,P){Alfresco.DocumentListFilmstripViewRenderer.superclass.constructor.call(this,O,P);this.parentElementIdSuffix="-filmstrip";this.windowResizeCheckTime=g;this.windowResizeMinTime=A;return this};YAHOO.extend(Alfresco.DocumentListFilmstripViewRenderer,Alfresco.DocumentListGalleryViewRenderer);Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavItemId=function p(O){if(this.documentList!=null&&O!=null){return this.documentList.id+"-filmstrip-nav-item-"+O.getId()}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavItem=function l(R,S){if(this.documentList!=null&&R!=null){var T=this.getFilmstripNavItemId(R);var P=E.get(T);if(P===null&&S!=null){var Q=E.getAncestorByTagName(S,"tr");var O=this.documentList.id+"-filmstrip-nav-item-"+Q.id;P=document.getElementById(O);if(P!==null){P.setAttribute("id",T)}}return P}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavItemThumbnailElement=function H(O){if(O!=null){return E.getFirstChild(O)}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavItemLabelElement=function x(P){if(P!=null){var O=this.getFilmstripNavItemThumbnailElement(P);return E.getChildren(O)[0]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripCarouselContainerId=function D(O){if(O!=null){return O.id+"-filmstrip-carousel"}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavElement=function e(O){if(O!=null){return E.get(O.id+"-filmstrip-nav")}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavCarouselContainerId=function F(O){if(O!=null){return O.id+"-filmstrip-nav-carousel"}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getRowItemLabelElement=function K(P){if(P!=null){var O=this.getRowItemHeaderElement(P);return E.getChildren(O)[2]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getRowItemActionsElement=function u(O){if(O){var P=this.getRowItemDetailElement(O);return E.getChildren(E.getFirstChild(P))[1]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getRowItemStatusElement=function w(O){if(O!=null){var P=this.getRowItemDetailElement(O);return E.getChildren(E.getFirstChild(P))[0]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getRowItemInfoButtonElement=function c(P){if(P!=null){var O=this.getRowItemHeaderElement(P);return E.getChildren(O)[1]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.onClickFilmstripContentNavItem=function t(P,O){if(P!=null&&O!=null){P.widgets.filmstripCarousel.scrollTo(O,false)}};Alfresco.DocumentListFilmstripViewRenderer.prototype.onFilmstripMainContentChanged=function y(Q,O){if(Q!=null){this.destroyWebPreview(Q,O);this.renderWebPreview(Q,O);var R=Q.widgets.filmstripNavCarousel.getPageForItem(O)-1;var P=Q.widgets.filmstripNavCarousel.get("currentPage");if(R!=P){var S=Q.widgets.filmstripNavCarousel.getFirstVisibleOnPage(R+1);Q.widgets.filmstripNavCarousel.scrollTo(S,true)}}};Alfresco.DocumentListFilmstripViewRenderer.prototype.onToggleHeaderAndNav=function I(W){if(W!=null){var Q=this;var P=E.get(W.id+this.parentElementIdSuffix);var T=W.widgets.filmstripCarousel.get("currentPage");var O=E.getFirstChild(W.widgets.filmstripCarousel.getElementForItem(T));var S=this.getRowItemHeaderElement(O);var R=this.getFilmstripNavElement(W);var V,U;if(!E.hasClass(P,"alf-filmstrip-content-only")){U=new r(R,{bottom:{to:-q}},0.2);V=new r(S,{top:{to:-G}},0.2);V.onComplete.subscribe(function(){E.addClass(P,"alf-filmstrip-content-only")})}else{E.setStyle(S,"top","-"+G+"px");E.removeClass(P,"alf-filmstrip-content-only");U=new r(R,{bottom:{to:0}},0.2);V=new r(S,{top:{to:0}},0.2);V.onComplete.subscribe(function(){var Z,Y,X,aa=W.widgets.filmstripCarousel.getElementForItems();for(Z=0,Y=aa.length;Z<Y;Z++){X=Q.getRowItemHeaderElement(E.getFirstChild(aa[Z]));E.setStyle(X,"top","0px")}})}V.animate();U.animate()}};Alfresco.DocumentListFilmstripViewRenderer.prototype.setupRenderer=function a(S){E.addClass(S.id+this.buttonElementIdSuffix,this.buttonCssClass);this.documentList=S;var Q=E.get(S.id+this.parentElementIdSuffix);var R=this;C.delegate(Q,"mouseover",function T(W,V,U){R.onEventHighlightRow(S,W,V)},"div."+this.rowClassName,this);C.delegate(Q,"click",function P(W,V,U){R.onShowGalleryItemDetail(S,R,W,V,U)},".alf-show-detail",this);C.addListener(E.get(S.id+"-filmstrip-nav-handle"),"click",function(U){R.onToggleHeaderAndNav(S)});C.delegate(Q,"click",function O(W,V,U){var X=C.getTarget(W);S.selectedFiles[X.value]=X.checked;YAHOO.Bubbling.fire("selectedFilesChanged")},".alf-select input",this);YAHOO.Bubbling.on("selectedFilesChanged",function(V,U){this.onSelectedFilesChanged(S)},this);YAHOO.Bubbling.on("webPreviewSetupComplete",function(X,W){var V=E.getElementsByClassName("alf-gallery-item","div");if(V!=null&&V.length>0){var Y=E.getElementsByClassName("WebPreviewer","div");if(Y!=null&&Y.length>0){var U=parseInt(V[0].style.height)-46;Y[0].style.height=U+"px"}}},this)};Alfresco.DocumentListFilmstripViewRenderer.prototype.destroyView=function J(R,P,Q,T){this.restoreDataTable(R);var S=E.get(this.getFilmstripCarouselContainerId(R));if(S!=null){E.get(this.getFilmstripCarouselContainerId(R)).innerHTML="";E.get(this.getFilmstripNavCarouselContainerId(R)).innerHTML=""}this.destroyWebPreview(R);E.addClass(E.get(R.id+this.parentElementIdSuffix),"hidden");E.addClass(E.get(R.id+this.parentElementEmptytIdSuffix),"hidden");var O=E.get(s);E.removeClass(O,"alf-filmstrip-dragging");if(this.windowResizeCallback){C.removeListener(window,"resize",this.windowResizeCallback)}};Alfresco.DocumentListFilmstripViewRenderer.prototype.renderView=function d(aq,aE,az,ak){this.overrideDataTable(aq);var Y=this;aq.widgets.dataTable.onDataReturnInitializeTable.call(aq.widgets.dataTable,aE,az,ak);var an=E.get(aq.id+this.parentElementIdSuffix);var af=aq.widgets.dataTable.getRecordSet();var T=E.get(aq.id+this.parentElementEmptytIdSuffix);if(af.getLength()==0){E.removeClass(T,"hidden");E.setStyle(T,"height","auto");return}E.addClass(T,"hidden");E.setStyle(an,"opacity",0);var V=E.get(aq.id+"-filmstrip-main-content");var ai=this.getFilmstripCarouselContainerId(aq);var ae=E.get(ai);ae.innerHTML="";var aC=document.createElement("ol");ae.appendChild(aC);var Q=E.get(aq.id+"-filmstrip-nav");var Z=this.getFilmstripNavCarouselContainerId(aq);var ao=E.get(Z);ao.innerHTML="";var ad=document.createElement("ol");ao.appendChild(ad);E.addClass(an,"alf-gallery");E.addClass(an,"alf-filmstrip");E.removeClass(an,"hidden");var U=parseInt(E.getComputedStyle(an,"width"));var aB=Math.floor((2/3)*U);var X=E.getViewportHeight()-N;if(E.hasClass(E.get(aq.id),"alf-fullscreen")){X=E.getViewportHeight()}if(aB>X){aB=X}var ac=E.get(aq.id+"-filmstrip-item-template"),O=E.get(aq.id+"-filmstrip-nav-item-template"),R=null,aj=null,ah=null,av=null;var ag,au,ay,ax;for(ay=0,ax=af.getLength();ay<ax;ay++){ag=af.getRecord(ay);au=ag.getData();ah=document.createElement("li");aC.appendChild(ah);av=document.createElement("li");ad.appendChild(av);var ap=this.getRowItemId(ag);R=ac.cloneNode(true);E.removeClass(R,"hidden");R.setAttribute("id",ap);R.style.width=U+"px";R.style.height=aB+"px";ah.appendChild(R);var am=this.getFilmstripNavItemId(ag);aj=O.cloneNode(true);E.removeClass(aj,"hidden");aj.setAttribute("id",am);aj.style.width=L+"px";C.addListener(aj,"click",function(aF){return function(aG){YAHOO.Bubbling.fire("filmstripNavItemClicked",{index:aF})}}(ay),this,true);av.appendChild(aj);var aA=this.getRowItemThumbnailElement(R);var al=this.getRowItemHeaderElement(R);var aw=this.getRowItemDetailElement(R);var W=this.getRowItemActionsElement(R);al.setAttribute("id",aq.id+"-item-header-"+ag.getId());W.setAttribute("id",aq.id+"-actions-"+ap);if(ay==0||(au.node.mimetype!=null&&au.node.mimetype.substring(0,MIMETYPE_PREFIX_IMAGE.length)==MIMETYPE_PREFIX_IMAGE)){this.destroyWebPreview(aq,ay);this.renderWebPreview(aq,ay)}var aD=this.getFilmstripNavItemThumbnailElement(aj);this.renderCellThumbnail(aq,aD,ag,R,null,"","doclib");var S=au.jsNode.nodeRef.nodeRef;var ab=new Alfresco.DnD(S,aq);var at=this.getRowItemInfoButtonElement(R);aw.panel=new YAHOO.widget.Panel(aw,{visible:false,draggable:false,close:false,constraintoviewport:true,underlay:"none",width:B,context:[R,"tr","tr",null,n]})}aq.widgets.filmstripCarousel=new YAHOO.widget.Carousel(this.getFilmstripCarouselContainerId(aq),{animation:{speed:0.2},numVisible:1,navigation:{prev:aq.id+"-filmstrip-nav-main-previous",next:aq.id+"-filmstrip-nav-main-next"}});aq.widgets.filmstripCarousel.render();aq.widgets.filmstripCarousel.show();var P=Math.floor((U-(k*2))/(L+b));aq.widgets.filmstripNavCarousel=new YAHOO.widget.Carousel(this.getFilmstripNavCarouselContainerId(aq),{animation:{speed:0.5},numVisible:P,navigation:{prev:aq.id+"-filmstrip-nav-previous",next:aq.id+"-filmstrip-nav-next"}});aq.widgets.filmstripNavCarousel.render();aq.widgets.filmstripNavCarousel.show();YAHOO.Bubbling.on("filmstripNavItemClicked",function(aG,aF){this.onClickFilmstripContentNavItem(aq,aF[1].index)},this);aq.widgets.filmstripCarousel.on("pageChange",function(aF){Y.onFilmstripMainContentChanged(aq,aF)});var ar=E.get(s);E.addClass(ar,"alf-filmstrip-dragging");this.currentResizeCallback=function(aF){Y.resizeView(aq,aE,az,ak)};this.setupWindowResizeListener();var aa=new YAHOO.util.Anim(an,{opacity:{from:0,to:1}},0.4,YAHOO.util.Easing.easeOut);aa.animate()};Alfresco.DocumentListFilmstripViewRenderer.prototype.renderWebPreview=function o(X,T){var W;var V=X.widgets.dataTable.getRecordSet();if(V.getLength()>0){var Y=V.getRecord(T);var S=Y.getData();var Q=this.getRowItemId(Y);var P=document.getElementById(Q);var R=this.getRowItemThumbnailElement(P);var O=this.getThumbnail(X,R,Y,null,null,"-filmstrip-main-content");if(O.isContainer){if(!document.getElementById(O.id)){R.innerHTML+='<span class="folder">'+(O.isLink?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(X,S)+O.html+"</a>"}}else{var U=E.getElementsByClassName("web-preview","div",R);if(U==null||U.length==0){Alfresco.util.loadWebscript({url:Alfresco.constants.URL_SERVICECONTEXT+"/components/preview/web-preview",properties:{nodeRef:S.nodeRef},target:R})}}}};Alfresco.DocumentListFilmstripViewRenderer.prototype.destroyWebPreview=function v(Q,P){var R=E.getElementsByClassName("real","div");if(R!=null){for(i=0,j=R.length;i<j;i++){if(E.hasClass(R[i],"web-preview")){R[i].parentNode.removeChild(R[i])}}}var O=E.getElementsByClassName("WebPreviewer","div");if(O!=null){for(i=0,j=O.length;i<j;i++){if(E.hasClass(O[i],"previewer")){O[i].parentNode.parentNode.parentNode.removeChild(O[i].parentNode.parentNode)}}}};Alfresco.DocumentListFilmstripViewRenderer.prototype.resizeView=function M(S,P,R,T){var O=E.get(S.id+this.parentElementIdSuffix);if(!E.hasClass(O,"alf-true-fullscreen")){var Q=S.widgets.filmstripCarousel.get("currentPage");this.renderView(S,P,R,T);setTimeout(function(){S.widgets.filmstripCarousel.scrollTo(Q,false)},50)}};Alfresco.DocumentListFilmstripViewRenderer.prototype.onSelectedFilesChanged=function m(Y){var W=Y.widgets.dataTable.getRecordSet(),Z,V,P,X,Q,U,T;var S=false;for(U=0,T=W.getLength();U<T;U++){Z=W.getRecord(U);P=Z.getData("jsNode");X=P.nodeRef;Q=this.getFilmstripNavItem(Z);var R=Y.selectedFiles[X];if(R){E.addClass(Q,"alf-selected");S=true}else{E.removeClass(Q,"alf-selected")}}var O=E.get(Y.id+this.parentElementIdSuffix);if(S){if(!E.hasClass(O,"alf-selected")){E.addClass(O,"alf-selected")}}else{E.removeClass(O,"alf-selected")}};Alfresco.DocumentListFilmstripViewRenderer.prototype.renderCellThumbnail=function f(Y,X,Z,T,P,Q,S){var V;var O=this.getThumbnail(Y,X,Z,T,P,Q,S);var R=Z.getData();if(!document.getElementById(O.id)){if(O.isContainer){X.innerHTML+='<span class="folder">'+(O.isLink?'<span class="link"></span>':"")+(Y.dragAndDropEnabled?'<span class="droppable"></span>':"")+O.html;V=new YAHOO.util.DDTarget(O.id)}else{X.innerHTML+=(O.isLink?'<span class="link"></span>':"")+O.html}var U=document.getElementById(O.id);if(U){var W=new Image();W.onload=function(){if(W.width>W.height){E.addClass(U,"alf-landscape")}};W.src=U.src}}};Alfresco.DocumentListFilmstripViewRenderer.prototype.renderCellDescription=function h(Q,T,S,U,V){Alfresco.DocumentListGalleryViewRenderer.superclass.renderCellDescription.call(this,Q,T,S,U,V);var R=this.getRowItem(S,T);if(R!==null){var O=this.getRowItemDetailDescriptionElement(R).innerHTML=T.innerHTML;T.innerHTML="";this.getRowItemLabelElement(R).innerHTML=z(S.getData().displayName)}var P=this.getFilmstripNavItem(S,T);if(P!==null){this.getFilmstripNavItemLabelElement(P).innerHTML=z(S.getData().displayName)}}})();