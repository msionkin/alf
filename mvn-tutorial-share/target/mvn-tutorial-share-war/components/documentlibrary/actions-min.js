(function(){var O=YAHOO.util.Dom,M=YAHOO.util.Event;var L=Alfresco.util.encodeHTML,G=Alfresco.util.combinePaths,F=Alfresco.util.siteURL,R=Alfresco.util.isValueSet;var i;Alfresco.doclib.Actions={};Alfresco.doclib.Actions.prototype={actionsView:null,onRegisterAction:function y(Z,Y){var aa=Y[1];if(aa&&R(aa.actionName)&&R(aa.fn)){this.registerAction(aa.actionName,aa.fn)}else{Alfresco.logger.error("DL_onRegisterAction: Custom action registion invalid: "+aa)}},registerAction:function c(Y,Z){if(R(Y)&&R(Z)){this.constructor.prototype[Y]=Z;return true}return false},renderAction:function Q(Z,ac){var Y=Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/actions/",ae='style="background-image:url('+Y+'{icon}-16.png)" ',ab={link:'<div class="{id}"><a title="{label}" class="simple-link" href="{href}" '+ae+"{target}><span>{label}</span></a></div>",pagelink:'<div class="{id}"><a title="{label}" class="simple-link" href="{pageUrl}" '+ae+"><span>{label}</span></a></div>",javascript:'<div class="{id}" id="{jsfunction}"><a title="{label}" class="action-link" href="#"'+ae+"><span>{label}</span></a></div>"};ac.actionParams[Z.id]=Z.params;var aa={id:Z.id,icon:Z.icon,label:L(Alfresco.util.substituteDotNotation(this.msg(Z.label),ac))};if(Z.type==="link"){if(Z.params.href){aa.href=Alfresco.util.substituteDotNotation(Z.params.href,ac);aa.target=Z.params.target?'target="'+Z.params.target+'"':""}else{Alfresco.logger.warn("Action configuration error: Missing 'href' parameter for actionId: ",Z.id)}}else{if(Z.type==="pagelink"){if(Z.params.page){aa.pageUrl=Alfresco.util.substituteDotNotation(Z.params.page,ac);if(Z.params.page.charAt(0)!=="{"){var ad=R(ac.location.site)?ac.location.site.name:null;aa.pageUrl=F(aa.pageUrl,{site:ad})}}else{Alfresco.logger.warn("Action configuration error: Missing 'page' parameter for actionId: ",Z.id)}}else{if(Z.type==="javascript"){if(Z.params["function"]){aa.jsfunction=Z.params["function"]}else{Alfresco.logger.warn("Action configuration error: Missing 'function' parameter for actionId: ",Z.id)}}}}return YAHOO.lang.substitute(ab[Z.type],aa)},getActionUrls:function u(ae,Z){var ab=ae.jsNode,ah=ab.isLink?ab.linkedNode.nodeRef:ab.nodeRef,af=ah.toString(),Y=ah.uri,ad=ab.contentURL,ai=ae.workingCopy||{},aa=R(ae.location.site)?ae.location.site.name:null,ag=Alfresco.util.bind(function(aj){return Alfresco.util.siteURL(aj,{site:YAHOO.lang.isString(Z)?Z:aa})},this),ac={downloadUrl:G(Alfresco.constants.PROXY_URI,ad)+"?a=true",viewUrl:G(Alfresco.constants.PROXY_URI,ad)+'" target="_blank',documentDetailsUrl:ag("document-details?nodeRef="+af),folderDetailsUrl:ag("folder-details?nodeRef="+af),editMetadataUrl:ag("edit-metadata?nodeRef="+af),inlineEditUrl:ag("inline-edit?nodeRef="+af),managePermissionsUrl:ag("manage-permissions?nodeRef="+af),manageTranslationsUrl:ag("manage-translations?nodeRef="+af),workingCopyUrl:ag("document-details?nodeRef="+(ai.workingCopyNodeRef||af)),workingCopySourceUrl:ag("document-details?nodeRef="+(ai.sourceNodeRef||af)),viewGoogleDocUrl:ai.googleDocUrl+'" target="_blank',explorerViewUrl:G(this.options.repositoryUrl,"/n/showSpaceDetails/",Y)+'" target="_blank',cloudViewUrl:G(Alfresco.constants.URL_SERVICECONTEXT,"cloud/cloudUrl?nodeRef="+af)};ac.sourceRepositoryUrl=this.viewInSourceRepositoryURL(ae,ac)+'" target="_blank';return ac},getAction:function X(Z,Y,ad){var af=Y.className,ac=Alfresco.util.findInArray(Z.actions,af,"id")||{};if(ad===false){return ac}else{ac=Alfresco.util.deepCopy(ac);var ae=ac.params||{};for(var aa in ae){ae[aa]=YAHOO.lang.substitute(ae[aa],Z,function ab(ah,ai,ag){return Alfresco.util.findValueByDotNotation(Z,ah)})}return ac}},getParentNodeRef:function W(Z){var ac=null;if(YAHOO.lang.isArray(Z)){try{ac=this.doclistMetadata.parent.nodeRef}catch(ad){ac=null}if(ac===null){for(var ab=1,aa=Z.length,Y=true;ab<aa&&Y;ab++){Y=(Z[ab].parent.nodeRef==Z[ab-1].parent.nodeRef)}ac=Y?Z[0].parent.nodeRef:this.doclistMetadata.container}}else{ac=Z.parent.nodeRef}return ac},onActionDetails:function H(ab){var ah=this,ad=ab.nodeRef,aa=ab.jsNode;var af=function Y(aj,ak){var ai='<span class="light">'+L(ab.displayName)+"</span>";Alfresco.util.populateHTML([ak.id+"-dialogTitle",ah.msg("edit-details.title",ai)]);this.widgets.editMetadata=Alfresco.util.createYUIButton(ak,"editMetadata",null,{type:"link",label:ah.msg("edit-details.label.edit-metadata"),href:F("edit-metadata?nodeRef="+ad)})};var Z=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"node",itemId:ad,mode:"edit",submitType:"json",formId:"doclib-simple-metadata"});var ag=new Alfresco.module.SimpleDialog(this.id+"-editDetails-"+Alfresco.util.generateDomId());ag.setOptions({width:"auto",templateUrl:Z,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:af,scope:this},onSuccess:{fn:function ac(aj){var al="components/documentlibrary/data";if(R(this.options.siteId)){al+="/site/"+encodeURIComponent(this.options.siteId)}Alfresco.util.Ajax.request({url:G(Alfresco.constants.URL_SERVICECONTEXT,al,"/node/",aa.nodeRef.uri)+"?view="+this.actionsView,successCallback:{fn:function ak(an){var am=an.json.item;am.jsNode=new Alfresco.util.Node(an.json.item.node);YAHOO.Bubbling.fire(am.node.isContainer?"folderRenamed":"fileRenamed",{file:am});YAHOO.Bubbling.fire("tagRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")});this._updateDocList.call(this)},scope:this},failureCallback:{fn:function ai(am){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function ae(ai){var aj=this.msg("message.details.failure");if(ai.json&&ai.json.message.indexOf("Failed to persist field 'prop_cm_name'")!==-1){aj=this.msg("message.details.failure.name")}Alfresco.util.PopupManager.displayMessage({text:aj})},scope:this}}).show()},onActionLocate:function V(Y){var aa=Y.jsNode,ac=Y.location.path,Z=aa.isLink?aa.linkedNode.properties.name:Y.displayName,ab=R(Y.location.site)?Y.location.site.name:null;if(R(this.options.siteId)&&ab!==this.options.siteId){window.location=F((ab===null?"repository":"documentlibrary")+"?file="+encodeURIComponent(Z)+"&path="+encodeURIComponent(ac),{site:ab})}else{this.options.highlightFile=Z;YAHOO.Bubbling.fire("changeFilter",{filterId:"path",filterData:ac})}},onActionDelete:function P(aa){var ae=this,Y=aa.jsNode,ad=Y.isContainer?"folder":"document",af=aa.displayName,Z=(this.options.syncMode==="CLOUD");var ag=this.msg("message.confirm.delete",af);if(Y.hasAspect("sync:syncSetMemberNode")){if(Z){ag+=this.msg("actions.synced.cloud."+ad+".delete",af)}else{ag+=this.msg("actions.synced."+ad+".delete",af)}}Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+ad+".delete"),text:ag,noEscape:true,buttons:[{text:this.msg("button.delete"),handler:function ac(){this.destroy();ae._onActionDeleteConfirm.call(ae,aa)}},{text:this.msg("button.cancel"),handler:function ab(){this.destroy()},isDefault:true}]})},_onActionDeleteConfirm:function T(Z){var ad=Z.jsNode,ae=Z.location.path,af=Z.location.file,ab=G(ae,af),Y=Z.displayName,ac=ad.nodeRef,aa=this.getParentNodeRef(Z);this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:ad.isContainer?"folder-deleted":"file-deleted",page:"documentlibrary",activityData:{fileName:af,path:ae,nodeRef:ac.toString(),parentNodeRef:aa.toString()}},event:{name:ad.isContainer?"folderDeleted":"fileDeleted",obj:{path:ab}},message:this.msg("message.delete.success",Y)},failure:{message:this.msg("message.delete.failure",Y)},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:ac.uri}},wait:{message:this.msg("message.multiple-delete.please-wait")}})},onActionEditOffline:function b(Y){Alfresco.logger.error("onActionEditOffline","Abstract implementation not overridden")},onlineEditMimetypes:{"application/msword":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word.Document","application/vnd.ms-word.document.macroenabled.12":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"Word.Document","application/vnd.ms-word.template.macroenabled.12":"Word.Document","application/vnd.ms-powerpoint":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPoint.Slide","application/vnd.ms-powerpoint.presentation.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"PowerPoint.Slide","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.template":"PowerPoint.Slide","application/vnd.ms-powerpoint.template.macroenabled.12":"PowerPoint.Slide","application/vnd.ms-powerpoint.addin.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slide":"PowerPoint.Slide","application/vnd.ms-powerpoint.slide.macroEnabled.12":"PowerPoint.Slide","application/vnd.ms-excel":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"Excel.Sheet","application/vnd.ms-excel.sheet.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.template.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.addin.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.sheet.binary.macroenabled.12":"Excel.Sheet","application/vnd.visio":"Visio.Drawing"},onActionEditOnline:function n(Y){if(!R(Y.onlineEditUrl)){Y.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,Y.location)}if(Y.onlineEditUrl.length>260){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.path.failure")})}else{if(this._launchOnlineEditor(Y)){YAHOO.Bubbling.fire("metadataRefresh")}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.failure")})}}},_launchOnlineEditor:function B(ac){var af="SharePoint.OpenDocuments",Z=ac.jsNode,ad=ac.location,ag=Z.mimetype,aa=null,ab=null,Y={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroenabled.12",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12"};if(!Alfresco.util.validLocationForOnlineEdit(ad)){Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.invalid",ad.file)});return true}if(this.onlineEditMimetypes.hasOwnProperty(ag)){aa=this.onlineEditMimetypes[ag]}else{var ae=Alfresco.util.getFileExtension(ac.location.file);if(ae!==null){ae=ae.toLowerCase();if(Y.hasOwnProperty(ae)){ag=Y[ae];if(this.onlineEditMimetypes.hasOwnProperty(ag)){aa=this.onlineEditMimetypes[ag]}}}}if(aa!==null){if(!R(ac.onlineEditUrl)){ac.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,ad)}if(YAHOO.env.ua.ie>0){return this._launchOnlineEditorIE(af,ac,aa)}if(Alfresco.util.isSharePointPluginInstalled()){return this._launchOnlineEditorPlugin(ac,aa)}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.failure",ad.file)});return false}}return window.open(ac.onlineEditUrl,"_blank")},_launchOnlineEditorIE:function I(aa,Y,Z){try{if(Z==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}activeXControl=new ActiveXObject(aa+".3");return activeXControl.EditDocument3(window,Y.onlineEditUrl,true,Z)}catch(ac){try{activeXControl=new ActiveXObject(aa+".2");return activeXControl.EditDocument2(window,Y.onlineEditUrl,Z)}catch(ad){try{activeXControl=new ActiveXObject(aa+".1");return activeXControl.EditDocument(Y.onlineEditUrl,Z)}catch(ab){}}}return false},_launchOnlineEditorPlugin:function g(Z,aa){var ab=document.getElementById("SharePointPlugin");if(ab==null&&Alfresco.util.isSharePointPluginInstalled()){var Y=null;if(YAHOO.env.ua.webkit&&Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint-webkit")){Y="application/x-sharepoint-webkit"}else{Y="application/x-sharepoint"}var af=document.createElement("object");af.id="SharePointPlugin";af.type=Y;af.width=0;af.height=0;af.style.setProperty("visibility","hidden","");document.body.appendChild(af);ab=document.getElementById("SharePointPlugin");if(!ab){return false}}try{if(aa==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}return ab.EditDocument3(window,Z.onlineEditUrl,true,aa)}catch(ad){try{return ab.EditDocument2(window,Z.onlineEditUrl,aa)}catch(ae){try{return ab.EditDocument(Z.onlineEditUrl,aa)}catch(ac){return false}}}},onActionCheckoutToGoogleDocs:function f(Y){Alfresco.logger.error("onActionCheckoutToGoogleDocs","Abstract implementation not overridden")},onActionCheckinFromGoogleDocs:function x(Y){Alfresco.logger.error("onActionCheckinFromGoogleDocs","Abstract implementation not overridden")},onActionSimpleRepoAction:function e(ad,Z){var ab=this.getAction(ad,Z).params,ah=ad.displayName,ag=["function","action","success","successMessage","failure","failureMessage"],ae={};for(var Y in ab){if(ab.hasOwnProperty(Y)&&!Alfresco.util.arrayContains(ag,Y)){ae[Y]=ab[Y]}}var af=Z.title;Z.title=Z.title+"_deactivated";var aa={success:{event:{name:"metadataRefresh",obj:ad}},failure:{message:this.msg(ab.failureMessage,ah),fn:function ac(){Z.title=af},scope:this},webscript:{method:Alfresco.util.Ajax.POST,stem:Alfresco.constants.PROXY_URI+"api/",name:"actionQueue"},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{actionedUponNode:ad.nodeRef,actionDefinitionName:ab.action,parameterValues:ae}}};if(YAHOO.lang.isFunction(this[ab.success])){aa.success.callback={fn:this[ab.success],obj:ad,scope:this}}if(ab.successMessage){aa.success.message=this.msg(ab.successMessage,ah)}if(YAHOO.lang.isFunction(this[ab.failure])){aa.failure.callback={fn:this[ab.failure],obj:ad,scope:this}}if(ab.failureMessage){aa.failure.message=this.msg(ab.failureMessage,ah)}this.modules.actions.genericAction(aa)},onActionFormDialog:function p(aa,Y){var ac=this.getAction(aa,Y),ae=ac.params,ab={title:this.msg(ac.label)},Z=aa.displayName;delete ae["function"];var ad=ae.success;delete ae.success;ab.success={fn:function(af,ag){if(YAHOO.lang.isFunction(this[ad])){this[ad].call(this,af,ag)}YAHOO.Bubbling.fire("metadataRefresh",ag)},obj:aa,scope:this};if(ae.successMessage){ab.successMessage=this.msg(ae.successMessage,Z);delete ae.successMessage}if(YAHOO.lang.isFunction(this[ae.failure])){ab.failure={fn:this[ae.failure],obj:aa,scope:this};delete ae.failure}if(ae.failureMessage){ab.failureMessage=this.msg(ae.failureMessage,Z);delete ae.failureMessage}ab.properties=ae;Alfresco.util.PopupManager.displayForm(ab)},onActionUploadNewVersion:function m(aa){var af=aa.jsNode,Z=aa.displayName,ac=af.nodeRef,Y=aa.version;if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var ae=this.msg("label.filter-description",Z),ab="*";if(Z&&new RegExp(/[^\.]+\.[^\.]+/).exec(Z)){ab="*"+Z.substring(Z.lastIndexOf("."))}if(aa.workingCopy&&aa.workingCopy.workingCopyVersion){Y=aa.workingCopy.workingCopyVersion}var ad={updateNodeRef:ac.toString(),updateFilename:Z,updateVersion:Y,overwrite:true,filter:[{description:ae,extensions:ab}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:this.onNewVersionUploadComplete,scope:this}};if(R(this.options.siteId)){ad.siteId=this.options.siteId;ad.containerId=this.options.containerId}this.fileUpload.show(ad)},_uploadComplete:function N(Y,ac){var ad=Y.successful.length,Z,ab;if(ad>0){if(ad<(this.options.groupActivitiesAt||5)){for(var aa=0;aa<ad;aa++){ab=Y.successful[aa];Z={fileName:ab.fileName,nodeRef:ab.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-"+ac,"document-details",Z)}}else{Z={fileCount:ad,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-"+ac,"documentlibrary",Z)}}},onFileUploadComplete:function r(Y){this._uploadComplete(Y,"added")},onNewVersionUploadComplete:function z(Y){this._uploadComplete(Y,"updated")},onActionCancelEditing:function k(Z){var Y=Z.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.edit-cancel.success",Y)},failure:{message:this.msg("message.edit-cancel.failure",Y)},webscript:{method:Alfresco.util.Ajax.POST,name:"cancel-checkout/node/{nodeRef}",params:{nodeRef:Z.jsNode.nodeRef.uri}}});YAHOO.Bubbling.fire("editingCanceled",{record:Z})},onActionCopyTo:function j(Y){this._copyMoveTo("copy",Y)},onActionMoveTo:function h(Y){this._copyMoveTo("move",Y)},_copyMoveTo:function E(ab,Z){if(!ab in {copy:true,move:true}){throw new Error("'"+ab+"' is not a valid Copy/Move to mode.")}if(!this.modules.copyMoveTo){this.modules.copyMoveTo=new Alfresco.module.DoclibCopyMoveTo(this.id+"-copyMoveTo")}var aa=Alfresco.module.DoclibGlobalFolder;var Y=[aa.VIEW_MODE_RECENT_SITES,aa.VIEW_MODE_FAVOURITE_SITES,aa.VIEW_MODE_SITE,aa.VIEW_MODE_SHARED];if(this.options.repositoryBrowsing===true){Y.push(aa.VIEW_MODE_REPOSITORY)}Y.push(aa.VIEW_MODE_USERHOME);this.modules.copyMoveTo.setOptions({allowedViewModes:Y,mode:ab,siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:Z,rootNode:this.options.rootNode,parentId:this.getParentNodeRef(Z)}).showDialog()},onActionAssignWorkflow:function d(Z){var ad="",Y=this.getParentNodeRef(Z);if(YAHOO.lang.isArray(Z)){for(var ab=0,aa=Z.length;ab<aa;ab++){ad+=(ab===0?"":",")+Z[ab].nodeRef}}else{ad=Z.nodeRef}var ac={selectedItems:ad};if(Y){ac.destination=Y}Alfresco.util.navigateTo(F("start-workflow"),"POST",ac)},onActionManagePermissions:function K(Y){if(!this.modules.permissions){this.modules.permissions=new Alfresco.module.DoclibPermissions(this.id+"-permissions")}this.modules.permissions.setOptions({siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:Y}).showDialog()},onActionManageAspects:function t(Y){if(!this.modules.aspects){this.modules.aspects=new Alfresco.module.DoclibAspects(this.id+"-aspects")}this.modules.aspects.setOptions({file:Y}).show()},onActionChangeType:function s(ac){var Y=ac.jsNode,ad=Y.type,af=ac.displayName,Z=Alfresco.constants.PROXY_URI+G("slingshot/doclib/type/node",Y.nodeRef.uri);var ag=function ab(ai){ai.addValidation(this.id+"-changeType-type",function ah(ao,ak,an,am,aj,al){return ao.options[ao.selectedIndex].value!=="-"},null,"change",null,{validationType:"mandatory"})};this.modules.changeType=new Alfresco.module.SimpleDialog(this.id+"-changeType").setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/change-type?currentType="+encodeURIComponent(ad),actionUrl:Z,doSetupFormsValidation:{fn:ag,scope:this},firstFocus:this.id+"-changeType-type",onSuccess:{fn:function ae(ah){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:af});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.success",af)})},scope:this},onFailure:{fn:function aa(ah){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.failure",af)})},scope:this}});this.modules.changeType.show()},viewInSourceRepositoryURL:function q(aa,ac){var ab=aa.node,Z=aa.location.repositoryId,Y=this.options.replicationUrlMapping,ad;if(!Z||!Y||!Y[Z]){return"#"}ad=ab.isContainer?ac.folderDetailsUrl:ac.documentDetailsUrl;ad=ad.substring(Alfresco.constants.URL_CONTEXT.length);return G(Y[Z],"/",ad)},onActionPublish:function l(Y){Alfresco.module.getSocialPublishingInstance().show({nodeRef:Y.nodeRef,filename:Y.fileName})},onActionCloudSync:function S(Y){if(!i){i=new Alfresco.module.DoclibCloudFolder(this.id+"-cloud-folder");var aa=this;YAHOO.Bubbling.on("folderSelected",function ab(ae,ad){this.updateSyncOptions();Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetdefinitions",dataObj:YAHOO.lang.merge(this.options.syncOptions,{memberNodeRefs:aa.getMemberNodeRefs(this.options.files),remoteTenantId:this.options.targetNetwork,targetFolderNodeRef:ad[1].selectedFolder.nodeRef}),successCallback:{fn:function af(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.sync.success")})},scope:this},failureMessage:this.msg("message.sync.failure")})},i)}else{var ac=i.widgets.optionInputs;if(ac){for(var Z=0;Z<ac.length;Z++){ac[Z].checked=ac[Z].defaultChecked}}}if(!this.modules.cloudAuth){this.modules.cloudAuth=new Alfresco.module.CloudAuth(this.id+"cloudAuth")}i.setOptions({files:Y});this.modules.cloudAuth.setOptions({authCallback:i.showDialog,authCallbackContext:i}).checkAuth()},onActionCloudUnsync:function D(aa){var af=this,ae=aa.jsNode.isContainer?"folder":"document",Z=aa.displayName,ad=(this.options.syncMode==="CLOUD"),Y=ad?"":'<div><input type="checkbox" id="requestDeleteRemote" class="requestDeleteRemote-checkBox"><span class="requestDeleteRemote-text">'+this.msg("sync.remove."+ae+".from.cloud",Z)+"</span></div>";Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+ae+".cloud-unsync"),noEscape:true,text:this.msg("message.unsync.confirm",Z)+Y,buttons:[{text:this.msg("button.unsync"),handler:function ab(){var ag=ad?false:O.getAttribute("requestDeleteRemote","checked");this.destroy();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetmembers/"+aa.jsNode.nodeRef.uri+"?requestDeleteRemote="+ag,method:Alfresco.util.Ajax.DELETE,successCallback:{fn:function ah(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:af.msg("message.unsync.success")})},scope:af},failureMessage:af.msg("message.unsync.failure")})}},{text:this.msg("button.cancel"),handler:function ac(){this.destroy()},isDefault:true}]})},onCloudSyncIndicatorAction:function A(Y,ac){var aa=new Alfresco.util.createInfoBalloon(this.widgets.dataTable.getTrEl(ac),{text:this.msg("label.loading"),width:"455px"});aa.show();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+Y.nodeRef.replace("://","/"),successCallback:{fn:function ab(ae){var af=this,ad={showTitle:true,showRequestSyncButton:true,showUnsyncButton:true,showMoreInfoLink:true};Alfresco.util.getSyncStatus(this,Y,ae.json,ad,function(ah){if(ah!=null){aa.html(ah.html);aa.requestsync=Alfresco.util.createYUIButton(af,"button-requestsyn",function(){af.onActionCloudSyncRequest(Y);aa.hide()},{id:af.id});if(!ah.showRequestSyncButton&&aa.requestsync!=null){aa.requestsync.setStyle("display","none")}aa.unsync=Alfresco.util.createYUIButton(af,"button-unsync",function(){af.onActionCloudUnsync(Y);aa.hide()},{id:af.id});if(!ah.showUnsyncButton&&aa.unsync!=null){aa.unsync.setStyle("display","none")}var ag=aa.content;Alfresco.util.syncClickOnShowDetailsLinkEvent(af,ag);Alfresco.util.syncClickOnHideLinkEvent(af,ag);Alfresco.util.syncClickOnTransientErrorShowDetailsLinkEvent(af,ag);Alfresco.util.syncClickOnTransientErrorHideLinkEvent(af,ag)}else{aa.hide()}})},scope:this},failureCallback:{fn:function Z(ad){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.unable.get.details")})},scope:this}})},onActionCloudSyncRequest:function w(Y,aa){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncrequest",dataObj:{memberNodeRefs:this.getMemberNodeRefs(Y)},successCallback:{fn:function Z(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request.sync.success")})},scope:this},failureMessage:this.msg("message.request.sync.failure")})},getMemberNodeRefs:function a(Y){var aa=new Array();if(YAHOO.lang.isArray(Y)){for(var Z in Y){aa.push(Y[Z].nodeRef)}}else{aa.push(Y.nodeRef)}return aa},onCloudSyncFailedIndicatorAction:function C(Y,Z){this.onCloudSyncIndicatorAction(Y,Z)},onCloudIndirectSyncIndicatorAction:function U(Y,Z){this.onCloudSyncIndicatorAction(Y,Z)},onCloudIndirectSyncFailedIndicatorAction:function J(Y,Z){this.onCloudSyncIndicatorAction(Y,Z)},onActionFolderDownload:function v(Y){var Z=Alfresco.getArchiveAndDownloadInstance(),aa={nodesToArchive:[{nodeRef:Y.nodeRef}],archiveName:Y.fileName};Z.show(aa)},onActionDownload:function o(Y){var Z=Alfresco.getArchiveAndDownloadInstance(),aa={nodesToArchive:[]};if(Y.length==1){aa.nodesToArchive.push({nodeRef:Y[0].nodeRef});aa.archiveName=Y[0].fileName}else{for(var ab=0;ab<Y.length;ab++){aa.nodesToArchive.push({nodeRef:Y[ab].nodeRef})}}Z.show(aa)}}})();