(function(){var g=YAHOO.util.Dom,b=YAHOO.util.Event;Alfresco.dashlet.DynamicWelcome=function e(i,j,l,k){Alfresco.dashlet.DynamicWelcome.superclass.constructor.call(this,"Alfresco.dashlet.DynamicWelcome",i);this.name="Alfresco.dashlet.DynamicWelcome";this.dashboardUrl=j;this.createSite=null;this.dashboardType=l;this.site=k;this.services.preferences=new Alfresco.service.Preferences();return this};YAHOO.extend(Alfresco.dashlet.DynamicWelcome,Alfresco.component.Base,{site:"",dashboardType:"",dashboardUrl:"",closeDialog:null,createSite:null,onReady:function f(){b.addListener(this.id+"-close-button","click",this.onCloseClick,this,true);b.addListener(this.id+"-createSite-button","click",this.onCreateSiteLinkClick,this,true);b.addListener(this.id+"-requestJoin-button","click",this.onRequestJoinLinkClick,this,true)},onCreateSiteLinkClick:function h(i){if(this.createSite===null){this.createSite=Alfresco.module.getCreateSiteInstance()}this.createSite.show();b.stopEvent(i)},onRequestJoinLinkClick:function a(j){var i=Alfresco.util.ComponentManager.findFirst("Alfresco.CollaborationTitle");if(i){i.requestJoinSite()}b.stopEvent(j)},onCloseConfirm:function d(k){if(this.dashboardType=="user"){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.URL_SERVICECONTEXT+"/components/dashlets/dynamic-welcome",dataObj:{dashboardUrl:this.dashboardUrl},successCallback:{fn:function(){document.location.href=Alfresco.constants.URL_PAGECONTEXT+""+this.dashboardUrl},scope:this},failureMessage:this.msg("message.saveFailure"),failureCallback:{fn:function(){this.widgets.feedbackMessage.destroy()},scope:this}})}else{var i=this.site.substring(1).replace(/\/|\./g,"-");this.services.preferences.set("org.alfresco.share.siteWelcome."+i,false,{successCallback:{fn:function j(){document.location.reload(true)}}})}},onCloseClick:function c(j,i){var k=this;Alfresco.util.PopupManager.displayPrompt({title:this.msg("panel.delete.header"),text:this.msg("panel.delete.msg"),buttons:[{text:this.msg("button.yes"),handler:function(){this.destroy();k.onCloseConfirm()}},{text:this.msg("button.no"),handler:function(){this.destroy()},isDefault:true}]});b.stopEvent(j)}})})();