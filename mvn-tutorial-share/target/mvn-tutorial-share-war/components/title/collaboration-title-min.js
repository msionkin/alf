(function(){var d=YAHOO.util.Dom,i=YAHOO.util.Event,a=YAHOO.util.Selector;Alfresco.CollaborationTitle=function(l){Alfresco.CollaborationTitle.superclass.constructor.call(this,"Alfresco.CollaborationTitle",l);return this};YAHOO.extend(Alfresco.CollaborationTitle,Alfresco.component.Base,{options:{user:null,site:null,siteTitle:null},onReady:function e(){i.on(d.get(this.id+"-join-link"),"click",function(l){this.joinSite();i.stopEvent(l)},this,true);i.on(d.get(this.id+"-requestJoin-link"),"click",function(l){this.requestJoinSite();i.stopEvent(l)},this,true);i.on(d.get(this.id+"-become-manager-link"),"click",function(l){this.becomeSiteManager();i.stopEvent(l)},this,true);this.widgets.more=new YAHOO.widget.Button(this.id+"-more",{type:"menu",menu:this.id+"-more-menu"});if(this.widgets.more.getMenu()){this.widgets.more.getMenu().subscribe("click",function(n,m){var o=m[1];if(o){switch(o.value){case"editSite":Alfresco.module.getEditSiteInstance().show({shortName:this.options.site});break;case"customiseSite":window.location=Alfresco.constants.URL_PAGECONTEXT+"site/"+this.options.site+"/customise-site";break;case"leaveSite":var p=this;Alfresco.util.PopupManager.displayPrompt({title:p.msg("message.leave",p.options.siteTitle),text:p.msg("message.leave-site-prompt",p.options.siteTitle),buttons:[{text:p.msg("button.ok"),handler:function q(){p.leaveSite();this.destroy()}},{text:p.msg("button.cancel"),handler:function l(){this.destroy()},isDefault:true}]});break}}},this,true)}d.removeClass(a.query(".links",this.id,true),"hidden")},joinSite:function f(){Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships",dataObj:{role:"SiteConsumer",person:{userName:this.options.user}},successCallback:{fn:function l(){window.location.reload()},scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.join-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.joining",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},requestJoinSite:function b(){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/invitations",dataObj:{invitationType:"MODERATED",inviteeUserName:this.options.user,inviteeComments:"",inviteeRoleName:"SiteConsumer"},successCallback:{fn:this._requestJoinSuccess,scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.request-join-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request-joining",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},becomeSiteManager:function g(){Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships",method:"POST",dataObj:{role:"SiteManager",person:{userName:this.options.user}},successCallback:{fn:this._becomeSiteManagerSuccess,scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.become-manager-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.become-manager",this.options.siteTitle),spanClass:"wait",displayTime:0})},_becomeSiteManagerSuccess:function k(l){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.success"),text:this.msg("message.become-manager-success"),buttons:[{text:this.msg("button.ok"),handler:function m(){this.destroy();window.location.reload(true)},isDefault:true}]})},_requestJoinSuccess:function j(l){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.success"),text:this.msg("message.request-join-success",this.options.user,this.options.siteTitle),buttons:[{text:this.msg("button.ok"),handler:function m(){this.destroy();window.location=Alfresco.constants.URL_CONTEXT},isDefault:true}]})},leaveSite:function c(){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships/"+encodeURIComponent(this.options.user),method:"DELETE",successCallback:{fn:function l(){window.location.href=Alfresco.constants.URL_CONTEXT},scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.leave-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.leaving",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},_failureCallback:function h(m,l){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}if(l){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:l})}}})})();