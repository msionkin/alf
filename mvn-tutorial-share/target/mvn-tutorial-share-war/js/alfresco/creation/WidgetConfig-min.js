define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/WidgetConfig.html","alfresco/core/Core","dojo/_base/lang","dijit/registry","dojo/_base/array","dijit/form/Button","dojo/dom-class"],function(j,e,o,p,d,c,a,l,k,m){return j([e,o,d],{cssRequirements:[{cssFile:"./css/WidgetConfig.css"}],i18nRequirements:[{i18nFile:"./i18n/WidgetConfig.properties"}],templateString:p,configTopic:"ALF_CONFIGURE_WIDGET",clearTopic:"ALF_CLEAR_CONFIGURE_WIDGET",postCreate:function f(){this.alfSubscribe(this.configTopic,c.hitch(this,"displayWidgetConfig"));this.alfSubscribe(this.clearTopic,c.hitch(this,"clearCurrentDisplay"));this.saveButton=new k({label:"Save",onClick:c.hitch(this,"saveWidgetConfig")},this.controlsNode);m.add(this.saveButton.domNode,"share-hidden")},currentWidgetConfig:null,saveWidgetConfig:function g(){if(this.currentWidgetConfig!=null){var q={};var s=a.findWidgets(this.configNode);for(var r=0;r<s.length;r++){var t=s[r];q[t.get("name")]=t.getValue()}this.alfPublish("ALF_UPDATE_RENDERED_WIDGET",{node:this.currentWidgetConfig.selectedNode,updatedConfig:q,originalConfig:this.currentWidgetConfig.selectedItem});this.clearCurrentDisplay()}},clearCurrentDisplay:function b(){var q=a.findWidgets(this.configNode);l.forEach(q,c.hitch(this,"destroyOldConfigWidget"));m.add(this.saveButton.domNode,"share-hidden")},displayWidgetConfig:function n(q){this.clearCurrentDisplay();if(c.exists("selectedItem.data.configWidgets",q)){this.currentWidgetConfig=q;this.processWidgets(q.selectedItem.data.configWidgets,this.configNode);m.remove(this.saveButton.domNode,"share-hidden")}if(c.exists("selectedItem.widgetsForConfig",q)){this.currentWidgetConfig=q;this.processWidgets(q.selectedItem.widgetsForConfig,this.configNode);m.remove(this.saveButton.domNode,"share-hidden")}},allWidgetsProcessed:function i(q){this.alfLog("log","Widget config processed")},destroyOldConfigWidget:function h(r,q){r.destroyRecursive(false)}})});