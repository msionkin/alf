define(["alfresco/forms/controls/MultipleEntryElement","dojo/_base/declare","alfresco/forms/PublishForm","alfresco/core/ObjectTypeUtils","dojo/_base/lang","dojo/_base/array","dijit/registry","alfresco/forms/controls/DojoValidationTextBox","alfresco/forms/controls/DojoSelect","alfresco/forms/controls/MultipleEntryFormControl"],function(i,j,n,p,f,k,b,l,e,a){return j([i],{i18nRequirements:[{i18nFile:"./i18n/ChoiceStepElement.properties"}],postCreate:function h(){this.alfSubscribe("ALF_FORM_FIELDS_UPDATE",f.hitch(this,"updateAvailableFields"));this.alfPublish("ALF_REQUEST_AVAILABLE_FORM_FIELDS",{});this.inherited(arguments)},updateAvailableFields:function m(r){var q=f.getObject("options",false,r);if(q!=null&&p.isArray(q)){this.availableFields=q}else{this.availableFields=[]}},readDisplayUpdateHandlers:null,createReadDisplay:function o(){k.forEach(this.readDisplayUpdateHandlers,function(v,u){this.alfRemoveDataListener(v)},this);this.readDisplayUpdateHandlers=[];var r=this.getValue();var q=(r.sourceStep!=null)?this.alfGetData(r.sourceStep+".name"):"",t=(r.field!=null)?this.alfGetData(r.field+".name"):"",s=(r.targetStep!=null)?this.alfGetData(r.targetStep+".name"):"";this.readDisplay.innerHTML=this.message("choiceStepElement.read.display",{sourceStep:q,field:t,operator:this.message("choiceStepElement.operator."+r.operator+".label"),value:r.operatorValue,targetStep:s});if(this.readDisplayUpdateHandlers==null){this.readDisplayUpdateHandlers=[]}if(r.sourceStep!=null){this.readDisplayUpdateHandlers.push(this.alfBindDataListener(r.sourceStep+".name",this.dataScope,f.hitch(this,"createReadDisplay")))}if(r.field!=null){this.readDisplayUpdateHandlers.push(this.alfBindDataListener(r.field+".name",this.dataScope,f.hitch(this,"createReadDisplay")))}},createEditDisplay:function g(){this.inherited(arguments);this.alfPublish("ALF_REQUEST_AVAILABLE_FORM_FIELDS",{})},getFormWidgets:function d(){return[{name:"alfresco/forms/controls/DojoSelect",config:{fieldId:"SourceStepSelect",name:"sourceStep",label:"choiceStepElement.sourceStep.label",description:"choiceStepElement.sourceStep.description",optionsConfig:{updateTopics:[{topic:this.pubSubScope+"ALF_FORM_FIELDS_UPDATE",global:true}],callback:"getOptionsFromPublication"}}},{name:"alfresco/forms/controls/DojoSelect",config:{fieldId:"FieldSelect",name:"field",label:"choiceStepElement.fieldSelect.label",description:"choiceStepElement.fieldSelect.description",optionsConfig:{changesTo:[{targetId:"SourceStepSelect"}],callback:f.hitch(this,"getFieldsFromStep")}}},{name:"alfresco/forms/controls/DojoSelect",config:{fieldId:"OperatorSelect",name:"operator",label:"choiceStepElement.operator.label",description:"choiceStepElement.operator.description",optionsConfig:{fixed:[{label:"choiceStepElement.operator.equalTo.label",value:"equalTo"},{label:"choiceStepElement.operator.notEqualTo.label",value:"notEqualTo"},{label:"choiceStepElement.operator.lessThan.label",value:"lessThan"},{label:"choiceStepElement.operator.moreThan.label",value:"moreThan"}]}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{fieldId:"OperatorValue",name:"operatorValue",label:"choiceStepElement.operatorValue.label",description:"choiceStepElement.operatorValue.description"}},{name:"alfresco/forms/controls/DojoSelect",config:{fieldId:"TargetStepSelect",name:"targetStep",label:"choiceStepElement.targetStep.label",description:"choiceStepElement.targetStep.description",optionsConfig:{updateTopics:[{topic:this.pubSubScope+"ALF_FORM_FIELDS_UPDATE",global:true}],callback:"getOptionsFromPublication"}}}]},getFieldsFromStep:function c(t,s){var q=[];if(s!=null){var r=b.byId(s.value);if(r!=null&&typeof r.getAvailableFormFields==="function"){q=r.getAvailableFormFields()}else{}}this.alfLog("log","Returning available form fields from step",q,t,s,this);return q}})});