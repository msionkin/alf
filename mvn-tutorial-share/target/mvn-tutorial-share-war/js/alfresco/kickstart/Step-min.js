define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Step.html","alfresco/core/Core","dojo/_base/lang","alfresco/menus/AlfMenuBar","alfresco/dialogs/AlfDialog","dojo/dom-construct","dojo/dom-class","dojo/fx","dojo/on"],function(s,n,j,t,o,u,d,h,g,l,p,m){return s([n,j,o],{cssRequirements:[{cssFile:"./css/Step.css"}],i18nRequirements:[{i18nFile:"./i18n/Step.properties"}],templateString:t,stepTitle:"",iconClass:"",collapsed:false,postCreate:function c(){this.alfSubscribe("ALF_KICKSTART_DELETE_STEP",u.hitch(this,"onDeleteStepRequest"));this.alfSubscribe("ALF_KICKSTART_RENAME_STEP",u.hitch(this,"onRenameStepRequest"));this.alfSubscribe("ALF_KICKSTART_DUPLICATE_STEP",u.hitch(this,"onDuplicateStepRequest"));this.alfSubscribe("ALF_KICKSTART_VIEW_STEP_FLOW",u.hitch(this,"onViewFlowRequest"));this.alfSubscribe("ALF_KICKSTART_DELETE_STEP_CONFIRMATION",u.hitch(this,"onDeleteStepConfirmation"));this.alfSubscribe("ALF_KICKSTART_RENAME_STEP_CONFIRMATION",u.hitch(this,"onRenameStepConfirmation"));this.configMenu=new d({pubSubScope:this.pubSubScope,widgets:[{name:"alfresco/menus/AlfMenuBarPopup",config:{label:"",iconClass:"alf-configure-icon",pubSubScope:this.pubSubScope,widgets:[{name:"alfresco/menus/AlfMenuGroup",config:{widgets:[{name:"alfresco/menus/AlfMenuItem",config:{label:"step.config.delete",publishTopic:"ALF_KICKSTART_DELETE_STEP",publishPayload:{}}},{name:"alfresco/menus/AlfMenuItem",config:{label:"step.config.rename",publishTopic:"ALF_KICKSTART_RENAME_STEP",publishPayload:{}}},{name:"alfresco/menus/AlfMenuItem",config:{label:"step.config.duplicate",publishTopic:"ALF_KICKSTART_DUPLICATE_STEP",publishPayload:{}}},{name:"alfresco/menus/AlfMenuItem",config:{label:"step.config.viewFlow",publishTopic:"ALF_KICKSTART_VIEW_STEP_FLOW",publishPayload:{}}}]}}]}}]});this.configMenu.placeAt(this.configControlNode);var v=this.getInitialContent();if(v.domNode!=null){g.place(v.domNode,this.mainNode)}},getInitialContent:function a(){return"Default"},onCollapseControlClick:function b(){if(this.collapsed==true){this.collapsed=false;l.remove(this.collapseControlNode,"collapsed");p.wipeIn({node:this.mainNode}).play()}else{this.collapsed=true;l.add(this.collapseControlNode,"collapsed");p.wipeOut({node:this.mainNode}).play()}},onDeleteStepRequest:function q(w){var v=new h({pubSubScope:this.pubSubScope,title:this.message("step.dialog.delete.title"),textContent:this.message("step.dialog.delete.content"),widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("step.dialog.button.delete"),publishTopic:"ALF_KICKSTART_DELETE_STEP_CONFIRMATION",publishPayload:w}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("step.dialog.button.cancel"),publishTopic:"ALF_KICKSTART_DELETE_STEP_CANCELLATION",publishPayload:w}}]});v.show()},onDeleteStepConfirmation:function f(v){m.emit(this.domNode,"onWidgetDelete",{bubbles:true,cancelable:true,widgetToDelete:this})},onRenameStepRequest:function k(w){var v=new h({pubSubScope:this.pubSubScope,title:this.message("step.dialog.rename.title"),widgetsContent:[{name:"alfresco/forms/controls/DojoValidationTextBox",assignTo:"contents",config:{label:"step.dialog.rename.name.label",description:"step.dialog.rename.name.description",value:this.name}}],widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("step.dialog.button.ok"),publishTopic:"ALF_KICKSTART_RENAME_STEP_CONFIRMATION",publishPayload:{dialog:v}}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("step.dialog.button.cancel"),publishTopic:"ALF_KICKSTART_RENAME_STEP_CANCELLATION",publishPayload:w}}]});v.show()},onRenameStepConfirmation:function i(w){this.alfLog("log","Rename confirmation",w);var v=w.dialogContent[0].getValue();this.titleNode.innerHTML=this.encodeHTML(v);this.alfSetData(this.id+".name",v);this.name=v},onDuplicateStepRequest:function e(v){},onViewFlowRequest:function r(w){var v=new h({pubSubScope:this.pubSubScope,title:this.message("step.dialog.rename.title"),widgetsContent:[{name:"alfresco/debug/CoreDataDebugger"}],widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("step.dialog.button.ok"),publishTopic:"ALF_KICKSTART_RENAME_STEP_CONFIRMATION",publishPayload:{dialog:v}}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("step.dialog.button.cancel"),publishTopic:"ALF_KICKSTART_RENAME_STEP_CANCELLATION",publishPayload:w}}]});v.show()}})});