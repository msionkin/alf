define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_KeyNavContainer","dijit/_CssStateMixin","dojo/text!./templates/HeaderJsWrapper.html","alfresco/core/Core","dojo/keys","dojo/dom-construct","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/aspect"],function(declare,_WidgetBase,_TemplatedMixin,_KeyNavContainer,_CssStateMixin,template,AlfCore,keys,domConstruct,domClass,domGeom,on,aspect){return declare([_WidgetBase,_TemplatedMixin,_KeyNavContainer,_CssStateMixin,AlfCore],{cssRequirements:[{cssFile:"./css/HeaderJsWrapper.css"}],templateString:template,templateMessages:null,objectToInstantiate:null,instantiatedObject:null,itemId:null,siteId:null,label:"",postCreate:function alfresco_wrapped_HeaderJsWrapper__postCreate(){if(this.objectToInstantiate&&this.itemId){var containerNode=domConstruct.create("div",{id:this.itemId});var c=eval(this.objectToInstantiate);this.instantiatedObject=new c(this.itemId);if(this.instantiatedObject&&typeof this.instantiatedObject.setOptions=="function"){var options={siteId:(this.siteId?this.siteId:"")};this.instantiatedObject.setOptions(options)}if(this.instantiatedObject){this.instantiatedObject.onReady()}domConstruct.place(containerNode,this._wrappedWidgetNode)}},startup:function alfresco_wrapped_HeaderJsWrapper__startup(){var _this=this;var parentMenuBar=this.getParent();if(parentMenuBar){aspect.after(parentMenuBar,"_moveToPopup",function(evt){if(this.focusedChild==_this){_this.showWrappedMenu()}},true)}},showWrappedMenu:function alfresco_wrapped_HeaderJsWrapper__showWrappedMenu(){this.alfLog("log","Opening wrapped menu");try{var pos=domGeom.position(this.focusNode);this.instantiatedObject.widgets.sitesButton.getMenu().moveTo(pos.x,pos.y+pos.h);this.instantiatedObject.widgets.sitesButton.getMenu().show()}catch(e){this.alfLog("log","No site button to get menu for",e)}},isFocusable:function alfresco_wrapped_HeaderJsWrapper__isFocusable(){var focusable=(this.instantiatedObject);this.alfLog("log","HeaderJsWrapper focusable?",focusable);return focusable},focus:function alfresco_wrapped_HeaderJsWrapper__focus(){this.alfLog("log","HeaderJsWrapper focus");this.focusNode.focus()},_onFocus:function alfresco_wrapped_HeaderJsWrapper___onFocus(){this.alfLog("log","Got focus");this._setSelected(true);this.getParent().focusChild(this);this.inherited(arguments)},_setSelected:function alfresco_wrapped_HeaderJsWrapper___setSelected(selected){this.alfLog("log","HeaderJsWrapper _setSelected",selected);domClass.toggle(this.domNode,"dijitMenuItemSelected",selected)},onClick:function alfresco_wrapped_HeaderJsWrapper__onClick(evt){this.showWrappedMenu()}})});