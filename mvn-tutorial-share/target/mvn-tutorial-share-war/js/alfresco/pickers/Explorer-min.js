define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Explorer.html","dojo/text!./templates/ExplorerTab.html","dojo/text!./templates/ExplorerItem.html","alfresco/core/Core","alfresco/core/CoreXhr","dojo/on","dojo/string","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojo/dom-style"],function(u,b,p,v,i,w,h,e,g,c,f,x,d,n){return u([b,p,h,e],{cssRequirements:[{cssFile:"./css/Explorer.css"}],templateString:v,currentLocations:null,nodeRef:"alfresco/company/home",postCreate:function t(){this.currentLocations=[];n.set(this.contentFrameNode,"width",this.contentFrameWidth+"px");this.serviceXhr({url:Alfresco.constants.PROXY_URI+"api/forms/picker/node/"+this.nodeRef+"/children",data:{selectableType:"cm:content",searchTerm:"",size:"1000"},method:"GET",successCallback:this.processLocations,callbackScope:this})},processLocations:function r(z,y){this.appendLocation(z.data.parent,z.data.items)},contentFrameWidth:500,idAttr:"nodeRef",locationDisplayAttr:"name",selectLocation:function o(z){var A=[];var y=false;f.forEach(this.currentLocations,function(B,C){if(y){A.splice(0,0,B)}if(B.id==z){y=true;this.focusLocation(B)}},this);setTimeout(x.hitch(this,"removeLocations",A),1000)},removeLocations:function m(y){f.forEach(y,function(z,A){this.removeLocation(z)},this)},focusLocation:function a(y){var z="-"+((y.index)*this.contentFrameWidth)+"px";n.set(this.contentItemsNode,"left",z)},appendLocation:function l(E,z){if(z==null){}else{}var A=this.currentLocations.length;n.set(this.contentItemsNode,"width",(this.contentFrameWidth*(A+1))+"px");var C=E[this.idAttr];var D=this.createLocationTab(E,A);g(D,"click",x.hitch(this,"selectLocation",C));d.place(D,this.navigationNode);var B=this.createLocationContent(E,z);d.place(B,this.contentItemsNode);var y={id:C,index:A,data:E,node:B,tab:D};this.currentLocations.push(y);this.focusLocation(y)},removeLocation:function q(y){this.contentItemsNode.removeChild(y.node);this.navigationNode.removeChild(y.tab);this.currentLocations.splice(y.index,1)},tabClass:"",createLocationTab:function k(A,y){var z=d.toDom(c.substitute(i,{tabClass:this.tabClass,index:y,title:A[this.locationDisplayAttr]}));return z},itemDisplayAttr:"name",createLocationContent:function s(A,z){var y=d.create("div",{className:"content-item",style:{width:this.contentFrameWidth+"px"}});f.forEach(z,function(C,B){var D=d.create("div",{innerHTML:C[this.itemDisplayAttr]},y);if(C.isContainer==true){g(D,"click",x.hitch(this,"getLocation",C[this.idAttr]))}},this);return y},getLocation:function j(y){this.serviceXhr({url:Alfresco.constants.PROXY_URI+"api/forms/picker/node/"+y.replace(/:\//g,"")+"/children",data:{selectableType:"cm:content",searchTerm:"",size:"1000"},method:"GET",successCallback:this.processLocations,callbackScope:this})}})});