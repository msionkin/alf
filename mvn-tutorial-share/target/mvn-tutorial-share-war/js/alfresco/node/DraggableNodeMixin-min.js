define(["dojo/_base/declare","alfresco/core/Core","dojo/dnd/Moveable","dojo/_base/event","dojo/dom-attr","dojo/on","dojo/_base/lang","dojo/fx","dojo/aspect","dojo/dom-style","dojo/dom-geometry"],function(p,h,q,m,o,g,r,c,i,k,n){return p([h],{draggableNode:null,moveable:null,mover:null,postCreate:function b(){this.inherited(arguments);if(this.draggableNode==null&&this.domNode!=null){this.draggableNode=this.domNode}if(this.draggableNode!=null){this.moveable=new q(this.draggableNode,{delay:20});i.before(this.moveable,"onMoveStart",r.hitch(this,"onDragStart"));i.after(this.moveable,"onMoveStop",r.hitch(this,"onDragEnd"),true);g(this.moveable.handle,"mousedown",r.hitch(this,"onMouseDown"));g(this.moveable.handle,"mouseup",r.hitch(this,"onMouseUp"));g(this.moveable.handle,"click",r.hitch(this,"onDraggableClick"))}},onMouseDown:function e(s){this.alfLog("log","On mouse down",s);var t=n.position(this.draggableNode);this.alfLog("log","Computed style: ",t.x,t.y);this.origX=t.x;this.origY=t.y},onMouseUp:function l(s){this.alfLog("log","On Mouse Up",s);if(this.mover!=null){this.alfLog("log","Calling mover onMouseUp");this.mover.onMouseUp(s);this.mover=null;m.stop(s)}},onDraggableClick:function a(s){this.alfLog("log","On draggable click",s,this.dragInFlight);if(this.dragInFlight){this.alfLog("log","Cancelling in flight");m.stop(s);this.dragInFlight=false}},origX:0,origY:0,onDragStart:function d(t,s){this.alfLog("log","Drag started",t,s);this.dragInFlight=true;this.mover=t;this.mover.alfCurrentItem=this.currentItem},onDragEnd:function j(s){this.alfLog("log","Drag ended",s);if(s.alfNodeDropClaimed){this.alfLog("log","Drop claimed!")}else{c.slideTo({node:this.draggableNode,top:this.origY,left:this.origX,units:"px",onEnd:r.hitch(this,"resetDraggableNodeStyle")}).play()}},resetDraggableNodeStyle:function f(){k.set(this.draggableNode,{position:"inherit",top:"inherit",left:"inherit"})}})});