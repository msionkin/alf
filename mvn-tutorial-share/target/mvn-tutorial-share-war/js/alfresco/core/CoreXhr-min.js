define(["dojo/_base/declare","dijit/registry","dojo/topic","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojox/uuid/generateRandomUuid","dojo/request/xhr","dojo/json","dojo/date/stamp"],function(g,c,j,h,e,f,b,n,l,a){return g(null,{cleanupJSONResponse:function d(p){var q=p;if(typeof p=="string"){q=p.replace(/,}/g,"}")}return q},serviceXhr:function k(p){var r=this;if(p){if(typeof p.url=="undefined"){this.alfLog("error","An XHR request was made but no URL was provided",p)}else{var q=(p.headers)?p.headers:{"Content-Type":"application/json"};if(Alfresco&&Alfresco.util&&Alfresco.util.CSRFPolicy&&Alfresco.util.CSRFPolicy.isFilterEnabled()){q[Alfresco.util.CSRFPolicy.getHeader()]=Alfresco.util.CSRFPolicy.getToken()}n(p.url,{handleAs:(p.handleAs)?p.handleAs:"text",method:(p.method)?p.method:"POST",data:(p.data)?l.stringify(p.data):null,query:(p.query)?p.query:null,headers:q}).then(function(t){if(typeof t=="string"){t=l.parse(r.cleanupJSONResponse(t))}if(typeof p.successCallback=="function"){var s=(p.successCallbackScope?p.successCallbackScope:(p.callbackScope?p.callbackScope:r));p.successCallback.call(s,t,p)}else{r.defaultSuccessCallback(t,p)}},function(t){if(typeof t=="string"){t=l.parse(r.cleanupJSONResponse(t))}if(typeof p.failureCallback=="function"){var s=(p.failureCallbackScope?p.failureCallbackScope:(p.callbackScope?p.callbackScope:r));p.failureCallback.call(s,t,p)}else{r.defaultFailureCallback(t,p)}},function(t){if(typeof t=="string"){t=l.parse(r.cleanupJSONResponse(t))}if(typeof p.progressCallback=="function"){var s=(p.progressCallbackScope?p.progressCallbackScope:(p.callbackScope?p.callbackScope:r));p.progressCallback.call(s,t,p)}else{r.defaultProgressCallback(t,p)}})}}else{this.alfLog("error","A request was made to perform an XHR request, but no configuration for the request was provided")}},defaultSuccessCallback:function o(q,p){this.alfLog("log","[DEFAULT CALLBACK] The following successful response was received",q,p);if(p.alfTopic){this.alfPublish(p.alfTopic+"_SUCCESS",{requestConfig:p,response:q})}},defaultFailureCallback:function m(r,p){this.alfLog("log","[DEFAULT CALLBACK] The following failure response was received",r,p);if(p.alfTopic){this.alfPublish(p.alfTopic+"_FAILURE",{requestConfig:p,response:r})}if(typeof this.displayMessage==="function"&&r.response.text){try{var q=l.parse(r.response.text);if(q.message){var u=q.message;var t=u.indexOf("Exception: ");if(t!==-1&&u.length>t+20){u=u.substring(t+20)}this.displayMessage(u)}}catch(s){}}},defaultProgressCallback:function i(q,p){this.alfLog("log","[DEFAULT CALLBACK] The following progress response was received",q,p);if(p.alfTopic){this.alfPublish(p.alfTopic+"_PROGRESS",{requestConfig:p,response:q})}}})});