define(["dojo/_base/declare","alfresco/core/CoreData","dijit/registry","dojo/topic","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojox/uuid/generateRandomUuid","dojo/request/xhr","dojo/json","dojo/date/stamp","dojox/html/entities","dojo/sniff"],function(e,u,F,k,g,f,C,h,J,j,i,s,d){return e(null,{generateUuid:function I(){return h()},message:function q(K){if(typeof K!="string"){throw new Error("Missing or invalid argument: messageId")}var P=K;if(typeof Alfresco.messages.global==="object"){var N=Alfresco.messages.global[K];if(typeof N=="string"){P=N}}if(typeof Alfresco.messages.pageScope==="object"){var L=Alfresco.messages.pageScope[K];if(typeof L=="string"){P=L}}if(typeof Alfresco.messages.scope[Alfresco.messages.defaultScope]==="object"){var M=Alfresco.messages.scope[Alfresco.messages.defaultScope][K];if(typeof M=="string"){P=M}}g.forEach(this.constructor._meta.parents,function(T,R){if(T._meta&&T._meta.hidden&&T._meta.hidden.i18nScope&&Alfresco.messages.scope[T._meta.hidden.i18nScope]){var S=Alfresco.messages.scope[T._meta.hidden.i18nScope][K];if(typeof S=="string"){P=S}}});var Q;if(typeof this.i18nScope!="undefined"&&typeof Alfresco.messages.scope[this.i18nScope]==="object"){var M=Alfresco.messages.scope[this.i18nScope][K];if(typeof M=="string"){P=M}}var O=[];if((arguments.length==2)&&(typeof arguments[1]=="object")){O=arguments[1]}else{O=Array.prototype.slice.call(arguments).slice(2)}if(O instanceof Array&&O.length>0){P=P.replace(/''/g,"'")}P=f.replace(P,O);return P},encodeHTML:function b(K){return s.encode(K)},dataScope:null,dataBindingCallbacks:null,alfProcessDataDotNotation:function p(K){var L=/(\.|\[)/g;return K.replace(L,"._alfValue$1")},alfSetData:function D(K,Q,M){this.alfLog("log","Setting data",K,Q,M,this);var N={};if(this.dataScope==null){this.dataScope=u.getSingleton().root}if(M==null){M=this.dataScope}K=this.alfProcessDataDotNotation(K);var P=f.getObject(K,false,M);if(P==null){}P=f.getObject(K,true,M);var L=P._alfValue;f.setObject(K+"._alfValue",Q,M);if(P._alfCallbacks!=null){for(var O in P._alfCallbacks){if(typeof P._alfCallbacks[O]==="function"){P._alfCallbacks[O](K,L,Q)}}}return N},alfGetData:function A(K,L){if(this.dataScope==null){this.dataScope=u.getSingleton().root}if(L==null){L=this.dataScope}K=this.alfProcessDataDotNotation(K);var M=f.getObject(K+"._alfValue",false,L);this.alfLog("log","Getting data",K,L,M,this);return M},alfBindDataListener:function m(K,L,P){if(K){this.alfLog("log","Binding data listener",K,L,P,this);if(this.dataScope==null){this.dataScope=u.getSingleton().root}if(L==null){L=this.dataScope}K=this.alfProcessDataDotNotation(K);var M=f.getObject(K+"._alfCallbacks",true,L);var N=this.generateUuid();M[N]=P;var O={scope:this.dataScope,dotNotation:K,callbackId:N};if(this.dataBindingCallbacks==null){this.dataBindingCallbacks=[]}this.dataBindingCallbacks.push(O);return O}},alfRemoveDataListener:function t(M){this.alfLog("log","Removing data binding",M);try{var K=f.getObject(M.dotNotation,false,M.scope);if(K!=null){delete K._alfCallbacks[M.callbackId]}}catch(L){this.alfLog("error","Could not delete data listener binding",M)}},pubSubScope:"",alfSubscriptions:null,alfPublish:function z(L,N,M){var K=(M?"":this.pubSubScope)+L;N.alfTopic=K;k.publish(K,N)},alfSubscribe:function o(L,O,M){var K=(M?"":this.pubSubScope)+L;var N=k.subscribe(K,O);if(this.alfSubscriptions==null){this.alfSubscriptions=[]}this.alfSubscriptions.push(N);return N},alfUnsubscribe:function n(K){if(K){K.remove()}},destroy:function H(K){if(typeof this.inherited==="function"){this.inherited(arguments)}if(this.alfSubscriptions!=null){g.forEach(this.alfSubscriptions,function(M,L){if(typeof M.remove==="function"){M.remove()}})}if(this.dataBindingCallbacks!=null){g.forEach(this.dataBindingCallbacks,function(M,L){this.alfRemoveDataListener(M)},this)}},processWidgets:function E(L,K){var M=this;if(L&&L instanceof Array){this.widgetProcessingComplete=false;this._processedWidgetCountdown=L.length;this._processedWidgets=[];g.forEach(L,f.hitch(this,"processWidget",K))}},processWidget:function r(K,N,L){if(this.filterWidget(N)){var M=this.createWidgetDomNode(N,K,N.className);this.createWidget(N,M,this._registerProcessedWidget,this)}},filterWidget:function a(K){return true},_processedWidgets:null,_processedWidgetCountdown:null,_registerProcessedWidget:function l(K,L){L._processedWidgetCountdown--;L._processedWidgets.push(K);if(L._processedWidgetCountdown==0){L.allWidgetsProcessed(L._processedWidgets);L.widgetProcessingComplete=true}},widgetProcessingComplete:false,allWidgetsProcessed:function y(K){this.alfLog("log","All widgets processed")},processServices:function B(K){var L=this;if(K){g.forEach(K,function(P,N){var Q=null,M={};if(typeof P==="string"){Q=P}else{if(typeof P==="object"&&P.name!=null){Q=P.name;if(typeof P.config==="object"){M=P.config}}}var O=[Q];require(O,function(R){new R(M)})})}},createWidgetDomNode:function c(N,L,K){var M=L;if(K!=null&&K!=""){M=C.create("div",{className:K},L)}return C.create("div",{},M)},createWidget:function G(K,M,R,P){var Q=this;this.alfLog("log","Creating widget: ",K);var O=(K&&K.config&&(typeof K.config==="object"))?K.config:{};if(typeof O.id=="undefined"){O.id=K.name+"___"+this.generateUuid()}if(O.generatePubSubScope===true){O.pubSubScope=this.generateUuid()}else{if(O.pubSubScope===undefined){O.pubSubScope=this.pubSubScope}}if(O.dataScope===undefined){O.dataScope=this.dataScope}var N=null;var L=[K.name];require(L,function(S){if(F.byId(O.id)!=null){O.id=K.name+"___"+Q.generateUuid()}N=new S(O,M);Q.alfLog("log","Created widget",N);N.startup();if(K.assignTo!=null){Q[K.assignTo]=N}if(R){R(N,P)}});if(N==null){this.alfLog("warn","A widget was not declared so that it's modules were included in the loader cache",K,this)}return N},processFunctionMixins:function w(){var K=this;if(this.functionMixins!=null){g.forEach(this.functionMixins,function(L,M){var N=[L];require(N,function(O){var P=new O();K.alfLog("log","Created mixin",P);e.safeMixin(K,P)})})}},getRelativeTime:function v(M,L){var K="";if(Alfresco&&Alfresco.util&&typeof Alfresco.util.relativeTime==="function"){K=Alfresco.util.relativeTime(M,L)}else{K=i.fromISOString(M);if(K){K=K.toGMTString()}else{K=""}}return K},alfLoggingTopic:"ALF_LOG_REQUEST",alfLog:function x(K,L){this.alfPublish(this.alfLoggingTopic,{callerName:arguments.callee.caller.name,severity:K,messageArgs:Array.prototype.slice.call(arguments,1)},true)}})});