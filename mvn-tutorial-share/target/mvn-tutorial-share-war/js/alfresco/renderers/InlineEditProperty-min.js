define(["dojo/_base/declare","alfresco/renderers/Property","dijit/_OnDijitClickMixin","alfresco/core/CoreXhr","dojo/text!./templates/InlineEditProperty.html","dojo/dom-class","dojo/html","dojo/dom-attr","dojo/_base/fx","dojo/keys","dojo/_base/event"],function(t,f,k,e,w,g,i,s,c,l,p){return t([f,k,e],{cssRequirements:[{cssFile:"./css/InlineEditProperty.css"}],templateString:w,postParam:null,postMixInProperties:function n(){this.inherited(arguments);if(this.postParam==null&&this.propertyToRender!=null){this.postParam="prop_"+this.propertyToRender.replace(/:/g,"_")}},onEditClick:function r(){if(this.renderPropertyNotFound){s.set(this.editInputNode,"value","")}g.toggle(this.renderedValueNode,"hidden");g.toggle(this.editNode,"hidden");this.editInputNode.focus()},onKeyPress:function b(x){if(x.ctrlKey==true&&x.charCode=="101"){p.stop(x);this.onEditClick()}},onValueEntryKeyPress:function j(x){if(x.charOrCode==l.ESCAPE){p.stop(x);this.onCancel()}else{if(x.charOrCode==l.ENTER){p.stop(x);this.onSave()}}},onSave:function d(){if(this.postParam!=null){var x={url:this.getSaveUrl(),method:"POST",data:this.getSaveData(),successCallback:this.onPropertyUpdate,failureCallback:this.onPropertyUpdateFailure,callbackScope:this};this.serviceXhr(x)}},getSaveUrl:function m(){var y=new Alfresco.util.NodeRef(this.currentItem.nodeRef);var x=Alfresco.constants.PROXY_URI+"api/node/"+y.uri+"/formprocessor";return x},getSaveData:function o(){var x={};x[this.postParam]=s.get(this.editInputNode,"value");return x},onPropertyUpdate:function u(x,A){this.alfLog("log","Property '"+this.propertyToRender+"' successfully updated for node: ",this.currentItem);this.renderedValue=A.data[this.postParam];var y=(this.requestedValuePrefix)?this.requestedValuePrefix:this.renderedValuePrefix;var z=(this.requestedValueSuffix)?this.requestedValueSuffix:this.renderedValueSuffix;i.set(this.renderedValueNode,y+this.renderedValue+z);g.remove(this.renderedValueNode,"hidden faded");g.add(this.editNode,"hidden");this.renderedValueNode.focus()},onPropertyUpdateFailure:function h(x,y){this.alfLog("warn","Property '"+this.propertyToRender+"' was not updated for node: ",this.currentItem);this.onCancel()},onCancel:function a(){g.remove(this.renderedValueNode,"hidden");g.add(this.editNode,"hidden");s.set(this.editInputNode,"value",this.renderedValue);this.renderedValueNode.focus()},showEditIcon:function q(){c.fadeIn({node:this.editIconNode}).play()},hideEditIcon:function v(){c.fadeOut({node:this.editIconNode}).play()}})});