define(["alfresco/forms/controls/BaseFormControl","dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/_base/lang"],function(l,e,h,c,b){return e([l],{cssRequirements:[{cssFile:"./css/JsonEditor.css"},{cssFile:"/js/lib/jsoneditorlib/jsoneditor-min.css"}],isPromisedWidget:true,getWidgetConfig:function g(){return{id:this.generateUuid(),name:this.name,value:this.value}},createFormControl:function f(q){var o=new h();var p=c.create("div",{className:"alfresco-forms-controls-JsonEditor"},this._controlNode);var r=this;var n=require;require(["jsoneditorlib/jsoneditor","jsoneditorlib/lib/ace/ace","jsoneditorlib/lib/jsonlint/jsonlint"],function(s){r.wrappedWidget=new s.JSONEditor(p,{mode:"code",change:b.hitch(r,"onEditorChange")});require=n;o.resolve(r.wrappedWidget)});return o.promise},placeWidget:function d(){},completeWidgetSetup:function k(){this.inherited(arguments);this.wrappedWidget.setText((this.initialConfig.value!=null&&this.initialConfig.value!="")?this.initialConfig.value:"{}")},onEditorChange:function m(){if(typeof this.wrappedWidget.getText==="function"){this._oldValue=this.__oldValue;this.__oldValue=this.wrappedWidget.getText();this.formControlValueChange(this.name,this._oldValue,this.__oldValue);this.validate()}},processValidationRules:function a(){var n=true;try{if(typeof this.wrappedWidget.getText==="function"){JSON.parse(this.wrappedWidget.getText())}}catch(o){n=false}return n},_oldValue:null,__oldValue:null,setupChangeEvents:function j(){},getValue:function i(){var n="";if(this.wrappedWidget!=null){n=this.wrappedWidget.getText()}return n}})});