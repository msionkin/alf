define(["dojo/_base/declare","alfresco/core/Core","alfresco/core/CoreXhr","alfresco/services/_QuickShareServiceTopicMixin","dojo/_base/lang"],function(j,e,f,c,d){return j([e,f,c],{constructor:function a(p){d.mixin(this,p);this.alfSubscribe(this.addQuickShareTopic,d.hitch(this,"onAddQuickShare"));this.alfSubscribe(this.removeQuickShareTopic,d.hitch(this,"onRemoveQuickShare"));this.alfSubscribe(this.getQuickShareLinkTopic,d.hitch(this,"onQuickShareLinkRequest"));this.alfSubscribe(this.getSocialLinksTopic,d.hitch(this,"onSocialLinksRequest"))},onQuickShareLinkRequest:function o(p){if(p!=null&&p.callback!=null&&p.callbackScope!=null){if(this.quickShareLink!=null){p.callback.call(p.callbackScope,this.quickShareLink)}else{this.alfLog("warn","A request was made for the QuickShare link but it has not been configured",this)}}else{this.alfLog("warn","A request was made for the QuickShare link, but either the 'callback' or 'callbackScope' attributes were not provided",p)}},onSocialLinksRequest:function h(p){if(p!=null&&p.callback!=null&&p.callbackScope!=null){if(this.socialLinks!=null){p.callback.call(p.callbackScope,this.socialLinks)}else{this.alfLog("warn","A request was made for the Social Links but they have not been configured",this)}}else{this.alfLog("warn","A request was made for the Social Links, but either the 'callback' or 'callbackScope' attributes were not provided",p)}},getAddQuickShareUrl:function n(p){return Alfresco.constants.PROXY_URI+"api/internal/shared/share/"+p},getRemoveQuickShareUrl:function n(p){return Alfresco.constants.PROXY_URI+"api/internal/shared/unshare/"+p},onAddQuickShare:function l(r){if(r!=null&&r.node!=null&&r.node.jsNode!=null&&r.node.jsNode.nodeRef!=null&&r.node.jsNode.nodeRef.uri!=null){var p=this.getAddQuickShareUrl(r.node.jsNode.nodeRef.uri);var q={node:r.node};this.serviceXhr({url:p,data:q,method:"POST",successCallback:this.onAddQuickShareSuccess,failureCallback:this.onAddQuickShareFailure,callbackScope:this})}},onAddQuickShareSuccess:function g(q,p){this.alfLog("log","Successfully quick shared a document",q,p);this.alfPublish(this.addQuickShareSuccessTopic,{response:q,requestConfig:p})},onAddQuickShareFailure:function k(q,p){this.alfLog("error","Failed to remove a document quick share",q,p);this.alfPublish(this.addQuickShareFailureTopic,{response:q,requestConfig:p})},onRemoveQuickShare:function i(r){if(r!=null&&r.node!=null&&(r.sharedId!=null||(r.node.jsNode!=null&&r.node.jsNode.properties!=null&&r.node.jsNode.properties["qshare:sharedId"]!=null))){var s=(r.sharedId!=null)?r.sharedId:r.node.jsNode.properties["qshare:sharedId"];var p=this.getRemoveQuickShareUrl(s);var q={node:r.node};this.serviceXhr({url:p,data:q,method:"DELETE",successCallback:this.onRemoveQuickShareSuccess,failureCallback:this.onRemoveQuickShareFailure,callbackScope:this})}},onRemoveQuickShareSuccess:function m(q,p){this.alfLog("log","Successfully removed a document quick share",q,p);this.alfPublish(this.removeQuickShareSuccessTopic,{response:q,requestConfig:p})},onRemoveQuickShareFailure:function b(q,p){this.alfLog("error","Failed to remove a document quick share",q,p);this.alfPublish(this.removeQuickShareFailureTopic,{response:q,requestConfig:p})}})});