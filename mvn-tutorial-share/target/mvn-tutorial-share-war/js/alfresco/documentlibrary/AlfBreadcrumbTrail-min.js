define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AlfBreadcrumbTrail.html","alfresco/core/Core","alfresco/documentlibrary/_AlfDocumentListTopicMixin","alfresco/documentlibrary/AlfBreadcrumb","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-class","dojo/on"],function(p,b,l,q,i,a,m,s,e,c,g,h){return p([b,l,i,a],{i18nRequirements:[{i18nFile:"./i18n/AlfBreadcrumbTrail.properties"}],cssRequirements:[{cssFile:"./css/AlfBreadcrumbTrail.css"}],templateString:q,hide:false,rootLabel:"root.label",showRootLabel:true,postCreate:function f(){this.alfSubscribe(this.metadataChangeTopic,s.hitch(this,"handleCurrentNodeChange"));this.alfSubscribe(this.filterChangeTopic,s.hitch(this,"onPathChanged"));this.alfSubscribe(this.showPathTopic,s.hitch(this,"onShowBreadcrumb"));this.alfSubscribe(this.filterSelectionTopic,s.hitch(this,"onFilterSelection"))},_currentNode:null,_currentFolderUrl:null,handleCurrentNodeChange:function o(t){if(t&&t.node){this._currentNode=t.node;if(t.node.parent&&t.node.parent.nodeRef){this._currentFolderUrl="folder-details?nodeRef="+t.node.parent.nodeRef}}else{this.alfLog("error","A request was made to update the current NodeRef, but no 'node' property was provided in the payload: ",t)}},currentPath:"",onPathChanged:function n(t){this.alfLog("log","Detected path change",t);if(t&&t.filterId=="path"&&t.filterData!=null){this.currentPath=t.filterData;this.renderBreadcrumbTrail()}},renderBreadcrumb:function d(x,w,t){var v=x.slice(0,t+1).join("/");var y=new m({label:w,path:v});c.place(y.domNode,this.containerNode,"last");if(t<x.length-1){var u=c.create("span",{innerHTML:"&nbsp;"});g.add(u,"alf-folder-separator");c.place(u,this.containerNode)}else{if(this._currentFolderUrl){y.targetUrl=this._currentFolderUrl}}},renderBreadcrumbTrail:function k(){c.empty(this.containerNode);var u=this.currentPath.split("/");if(this.currentPath==="/"){u=["/"]}if(u[u.length-1]==""){u.pop()}var t=u.concat();t[0]=this.message(this.rootLabel);if(!this.showRootLabel){t.shift();u.shift()}e.forEach(t,s.hitch(this,"renderBreadcrumb",u));if(this.hide){g.add(this.domNode,"hidden")}else{g.remove(this.domNode,"hidden")}},onShowBreadcrumb:function j(t){if(t&&t.selected!=null){this.hide=!t.selected;if(this.hide){g.add(this.domNode,"hidden")}else{g.remove(this.domNode,"hidden")}}},onFilterSelection:function r(t){if(t!=null&&t.description!=null){c.empty(this.containerNode);c.create("div",{innerHTML:t.description},this.containerNode)}else{this.alfLog("warn","A request was made to display filter information but no description was provided: ",t)}}})});